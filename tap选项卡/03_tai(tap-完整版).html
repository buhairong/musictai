<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no,minimum-scale=1.0,maximum-scale=1.0">
    <title>Title</title>
    <link rel="stylesheet" href="../css/tai.css">
</head>
<body>
    <div id="wrap">
        <div class="head">
            <div class="head-top">
                <h1 class="logo">
                    <a href="http://www.atguigu.com">
                        <img src="../img/logo.png">
                    </a>
                </h1>
                <a href="javascript:;" class="menuBtn"></a>
                <div class="btns">
                    <a href="javascript:;" class="search">搜索</a>
                    <a href="javascript:;">登录</a>
                    <a href="javascript:;">注册</a>
                </div>
            </div>
            <div class="head-bottom">
                <form method="post">
                    <input type="text" placeholder="请碰我一下">
                    <input type="submit" value="搜索">
                </form>
            </div>
            <ul class="mask">
                <li><a href="javascript:;">首页</a></li>
                <li><a href="javascript:;">MV</a></li>
                <li><a href="javascript:;">悦单</a></li>
                <li><a href="javascript:;">V榜</a></li>
                <li><a href="javascript:;">音乐</a></li>
                <li><a href="javascript:;">商城</a></li>
                <li><a href="javascript:;">节目</a></li>
                <li><a href="javascript:;">饭团</a></li>
                <li><a href="javascript:;">咨询</a></li>
                <li><a href="javascript:;">我的家</a></li>
                <li><a href="javascript:;">APP下载</a></li>
                <li><a href="javascript:;">热门应用</a></li>
            </ul>
        </div>
        <div class="content">
            <div class="damu-nav-drag-wrapper">
                <ul class="list">
                    <li><a href="javascript:;" class="active">首页</a></li>
                    <li><a href="javascript:;">MV</a></li>
                    <li><a href="javascript:;">悦单</a></li>
                    <li><a href="javascript:;">V榜</a></li>
                    <li><a href="javascript:;">音乐</a></li>
                    <li><a href="javascript:;">商城</a></li>
                    <li><a href="javascript:;">节目</a></li>
                    <li><a href="javascript:;">饭团</a></li>
                    <li><a href="javascript:;">咨询</a></li>
                    <li><a href="javascript:;">我的家</a></li>
                    <li><a href="javascript:;">APP下载</a></li>
                    <li><a href="javascript:;">热门应用</a></li>
                </ul>
            </div>
            <div class="carousel-wrap" needAuto needCarousel>
                <div class="points-wrap"></div>
            </div>
            <div class="tap-wrap">
                <div class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt;</span>
                </div>
                <div class="tap-nav">
                    <a href="javascript:;">全部</a>
                    <a href="javascript:;">内地</a>
                    <a href="javascript:;">港台</a>
                    <a href="javascript:;">欧美</a>
                    <a href="javascript:;">韩国</a>
                    <a href="javascript:;">日本</a>
                    <div class="smallG"></div>
                </div>
                <div class="tap-content">
                    <ul class="tap-loading"></ul>
                    <ul>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/a.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/b.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/c.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/d.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/e.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/f.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="tap-loading"></ul>
                </div>
            </div>
            <div class="tap-wrap">
                <div class="tap-head">
                    <h2>MV主播</h2>
                    <span>更多&gt;</span>
                </div>
                <div class="tap-nav">
                    <a href="javascript:;">全部</a>
                    <a href="javascript:;">内地</a>
                    <a href="javascript:;">港台</a>
                    <a href="javascript:;">欧美</a>
                    <a href="javascript:;">韩国</a>
                    <a href="javascript:;">日本</a>
                    <div class="smallG"></div>
                </div>
                <div class="tap-content">
                    <ul class="tap-loading"></ul>
                    <ul>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/a.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/b.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/c.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/d.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/e.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                        <li>
                            <a href="javascript:;">
                                <img src="../img/f.jpg">
                                <span>第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季第一季</span>
                            </a>
                            <div class="tap-discuss">
                                <div class="left">
                                    <span></span>
                                    <span>9176</span>
                                </div>
                                <div class="right">
                                    <span></span>
                                    <span>6</span>
                                </div>
                            </div>
                        </li>
                    </ul>
                    <ul class="tap-loading"></ul>
                </div>
            </div>
        </div>
    </div>
</body>
<script src="../js/tools.js"></script>
<script src="../js/damu.js"></script>
<script type="text/javascript">
    window.onload = function(){
        // 禁止默认事件(因为click延迟300毫秒，会造成事件点透)
        document.addEventListener('touchstart',function(ev){
            ev = ev || event
            ev.preventDefault();
        })

        // 使用rem适配
        ;(function(){
            var styleNode = document.createElement('style');
            var w = document.documentElement.clientWidth/16;
            styleNode.innerHTML = 'html{font-size:' + w + 'px!important}';
            document.head.appendChild(styleNode);
        })()

        //tab选项卡
        tap();
        function tap(){
            var wrap = document.querySelector(".tap-wrap");
            var contentNodes = document.querySelectorAll(".tap-wrap .tap-content");
            var w = wrap.offsetWidth;
            for(var i=0;i<contentNodes.length;i++){
                move(contentNodes[i]);
            }
            function move(content){
                damu.css(content,"translateX",-w);

                //滑屏逻辑 content既是滑屏区域又是滑屏元素
                var startPoint = {x:0,y:0};
                var elementPoint = {x:0,y:0};
                var isX=true;
                var isFirst=true;
                var isOver = false;
                content.addEventListener("touchstart",function(ev){
                    if(isOver){
                        return;
                    }
                    ev=ev||event;
                    var touchC = ev.changedTouches[0];
                    startPoint.x=touchC.clientX;
                    startPoint.y=touchC.clientY;
                    elementPoint.x=damu.css(content,"translateX");
                    elementPoint.y=damu.css(content,"translateY");
                    isX=true;
                    isFirst=true;
                    isOver=false;
                    content.style.transition = "none";
                })

                content.addEventListener("touchmove",function(ev){
                    if(isOver){
                        return;
                    }
                    if(!isX){
                        return;
                    }
                    ev=ev||event;
                    var touchC = ev.changedTouches[0];

                    var nowPoint={x:0,y:0};
                    var dis={x:0,y:0};
                    nowPoint.x=touchC.clientX;
                    nowPoint.y=touchC.clientY;
                    dis.x=nowPoint.x-startPoint.x;
                    dis.y=nowPoint.y-startPoint.y;

                    if(isFirst){
                        isFirst = false;
                        if(Math.abs(dis.y) > Math.abs(dis.x)){
                            isX=false;
                            return;
                        }
                    }

                    var translateX = elementPoint.x + dis.x;
                    damu.css(content,"translateX",translateX);

                    // 1/2跳转
                    jump(dis.x);
                })

                content.addEventListener("touchend",function(ev){
                    if(isOver){
                        return;
                    }
                    ev=ev||event;
                    var touchC = ev.changedTouches[0];
                    var nowPoint={x:0,y:0};
                    var dis={x:0,y:0};
                    nowPoint.x=touchC.clientX;
                    dis.x=nowPoint.x-startPoint.x;

                    if(Math.abs(dis.x) <= w/2){
                        content.style.transition = "1s transform";
                        damu.css(content,"translateX",-w);
                    }
                })

                // 1/2跳转 --> 请求
                function jump(disX){
                    if(isOver){
                        return;
                    }
                    if(Math.abs(disX) > w/2){
                        isOver=true;
                        content.style.transition = "1s transform";
                        var targetX = disX>0?0:-2*w;
                        damu.css(content,"translateX",targetX);

                        //请求一定要在动画执行完毕之后再发
                        content.addEventListener("transitionend",endFn);
                        content.addEventListener("webkitTransitionEnd",endFn);

                        function endFn(){

                        }
                    }
                }
            }
        }

        //导航点击变色
        changeColor();
        function changeColor() {
            var list = document.querySelector(".damu-nav-drag-wrapper .list");
            var aNodes = document.querySelectorAll(".damu-nav-drag-wrapper .list>li>a");
            list.addEventListener("touchstart",function(){
                this.isMove = false;
            })

            list.addEventListener("touchmove",function(){
                this.isMove = true;
            })
            list.addEventListener("touchend",function(ev){
                if(this.isMove){
                    return;
                }
                ev=ev||event;
                var touchC = ev.changedTouches[0];
                for(var i=0;i<aNodes.length;i++){
                    tools.removeClass(aNodes[i],"active");
                }
                tools.addClass(touchC.target,"active");
            })
        }

        swiper();
        function swiper(){
            var arr=["../img/1.jpg","../img/2.jpg","../img/3.jpg","../img/4.jpg","../img/5.jpg"]
            damu.carousel(arr);
        }

        //导航栏滑屏
        drag();
        function drag(){

            damu.dragNav();
        }

        changeFocus();
        function changeFocus(){
            var inputText = document.querySelector("#wrap .head .head-bottom form input[type='text']");
            inputText.addEventListener("touchstart",function(ev){
                ev = ev || event;
                this.focus();
                ev.stopPropagation();
                ev.preventDefault();
            })

            document.addEventListener("touchstart",function(){
                inputText.blur();
            })
        }

        CMCFMenuBtn();
        function CMCFMenuBtn(){
            var menuBtn = document.querySelector(".menuBtn");
            var mask = document.querySelector(".mask");
            var isXX = false;
            menuBtn.addEventListener("touchstart",function(ev){
                ev = ev || event;
                var touchC = ev.changedTouches[0];
                if(isXX){
                    tools.removeClass(this,"active");
                    mask.style.display = "none";
                }else{
                    tools.addClass(this,"active");
                    mask.style.display = "block";
                }
                isXX=!isXX;
                ev.stopPropagation();
                ev.preventDefault();
            })

            document.addEventListener("touchstart",function(v){
                if(isXX){
                    tools.removeClass(menuBtn,"active");
                    mask.style.display = "none";
                    isXX=!isXX;
                }
            })

            mask.addEventListener("touchstart",function(ev){
                ev = ev || event;
                ev.stopPropagation();
                ev.preventDefault();
            })
        }
    }
</script>
</html>